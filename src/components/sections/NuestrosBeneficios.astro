---
import { fetchWebData } from '../../services/api';
import { getTitleBeneficios } from '../../services/api';

const titleData = await getTitleBeneficios();
const tituloBeneficios = titleData.historyBenefitsTitle || ""
console.log(titleData, "titulo")

const result = await fetchWebData({ name: "Beneficio" });

interface Beneficio {
  _id: string;
  text: string;
  isHidden: boolean;
  imageUrl: string;
}


const beneficios = result || [];

---

<script>
  // Script para el carrusel m칩vil
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.getElementById('beneficios-mobile-carousel');
    const slides = carousel?.querySelectorAll('.beneficios-carousel-slide');
    const prevBtn = document.getElementById('beneficios-prev-btn');
    const nextBtn = document.getElementById('beneficios-next-btn');
    const indicators = document.querySelectorAll('.beneficios-carousel-indicator');
    
    let currentSlide = 0;
    const totalSlides = slides?.length || 0;

    function showSlide(index: number) {
      if (!slides) return;
      
      slides.forEach((slide, i) => {
        slide.classList.toggle('hidden', i !== index);
      });
      
      indicators.forEach((indicator, i) => {
        indicator.classList.toggle('bg-verdeArk', i === index);
        indicator.classList.toggle('bg-gray-300', i !== index);
      });
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % totalSlides;
      showSlide(currentSlide);
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
      showSlide(currentSlide);
    }

    // Event listeners
    nextBtn?.addEventListener('click', nextSlide);
    prevBtn?.addEventListener('click', prevSlide);

    // Auto-play (opcional)
    setInterval(nextSlide, 5000);

    // Inicializar
    showSlide(0);
  });
</script>

<section class="w-full px-4 py-12 md:px-12">
  <div class="flex flex-col items-center p-6 mx-auto bg-moradoArk max-w-7xl lg:flex-row md:p-12">
    <div class="mb-8 text-center lg:mb-0 lg:w-2/6">
      <h2 class="text-3xl leading-tight text-center lg:text-left text-verdeArk md:text-4xl lg:text-3xl font-akira-bold" >
        {tituloBeneficios}
      </h2>
    </div>
    
    {/* Carrusel para m칩vil - Solo visible en pantallas peque침as */}
    <div id="beneficios-mobile-carousel" class="block w-full lg:hidden">
      <div class="relative">
        {beneficios.map((beneficio: any, index: number) => (
          <div class={`beneficios-carousel-slide flex flex-col items-center text-center ${index === 0 ? '' : 'hidden'}`}>
            <div class="flex items-center justify-center w-16 h-16 mb-4">
              <img 
                src={beneficio.imageUrl} 
                alt={beneficio.text} 
                class="object-contain w-full h-full" 
                draggable="false" 
              />
            </div>
            <h3 class="px-4 text-sm font-medium leading-tight text-white">
              {beneficio.text}
            </h3>
          </div>
        ))}
        
        {/* Botones de navegaci칩n */}
        <button 
          id="beneficios-prev-btn" 
          class="absolute left-0 p-2 transition-colors transform -translate-y-1/2 rounded-full top-1/2 "
          aria-label="Slide anterior"
        >
          <svg class="w-6 h-6 text-verdeArk" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
          </svg>
        </button>
        
        <button 
          id="beneficios-next-btn" 
          class="absolute right-0 p-2 transition-colors transform -translate-y-1/2 rounded-full top-1/2 "
          aria-label="Siguiente slide"
        >
          <svg class="w-6 h-6 text-verdeArk" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
          </svg>
        </button>
      </div>
      
      {/* Indicadores */}
      <div class="flex justify-center mt-6 space-x-2">
        {beneficios.map((_: Beneficio, index: number) => (
          <button 
            class={`beneficios-carousel-indicator w-3 h-3 rounded-full transition-colors ${index === 0 ? 'bg-verdeArk' : 'bg-gray-300'}`}
            aria-label={`Ir al slide ${index + 1}`}
          ></button>
        ))}
      </div>
    </div>

    {/* Grid para desktop - Solo visible en pantallas grandes */}
    <div class="hidden grid-cols-2 gap-4 md:gap-6 lg:gap-8 lg:grid lg:grid-cols-4 lg:w-4/5">
      {beneficios.map((beneficio: Beneficio, index: number) => (
        <div class="flex flex-col items-center text-center">
          <div class="flex items-center justify-center w-12 h-12 mb-3 md:w-16 md:h-16 md:mb-4">
            <img 
              src={beneficio.imageUrl} 
              alt={beneficio.text} 
              class="object-contain w-full h-full" 
              draggable="false" 
            />
          </div>
          <h3 class="text-xs font-medium leading-tight text-white md:text-sm">
            {beneficio.text}
          </h3>
        </div>
      ))}
      
    </div>
  </div>
</section>
